% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{lmodern}
\usepackage{amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
  \usepackage{amssymb}
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Evolution of group reciprocity},
  pdfauthor={David Hugh-Jones, Moti Michaeli, Ro'i Zultan},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\usepackage{amsmath}
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi

\title{Evolution of group reciprocity}
\author{David Hugh-Jones, Moti Michaeli, Ro'i Zultan}
\date{31/07/2019}

\begin{document}
\maketitle

\hypertarget{introduction}{%
\section{Introduction}\label{introduction}}

Humans reciprocate good actions for good and bad for bad {[}cites{]}.
Rather than reciprocating back at the person who harmed or helped them,
they may also pay it forward, passing on good or bad actions to a third
party. To date, evolutionary theorists have concentrated on models of
``generalized reciprocity,'' in which people who receive a good (bad)
turn become nicer (nastier) to everyone in the population.

Evidence from many venues suggests that often, reciprocity is more
narrowly focused than that. In civil wars, tit-for-tat conflicts take
place between groups. Ethnic riots can be sparked by the bad behaviour
(real or imagined) of an outgroup member; in revenge, the entire group
is targeted. Institutions like the blood feud involve cycles of
retaliation between different families or clans {[}cite boehm{]}. In all
these cases, reciprocity is aimed at specific groups.

\hypertarget{theory}{%
\section{Theory}\label{theory}}

\hypertarget{a-single-generation}{%
\subsection{A single generation}\label{a-single-generation}}

There are \(G\) groups. Each group has \(N\) members. The set of groups
is \(\mathcal{G} = \{1 ... G\}\).

{[}XXX may need group sizes to vary due to evolution, in which case N is
the group size above which the group splits/establishes new groups{]}

A single generation consists of \(T\) periods. In every period, each
individual ``acts'' against one randomly selected member (the
``target'') from \emph{each} group. That is, let \(P\) be the set of
permutations \((p_1, ..., p_N)\) of \((1, ..., N)\) such that
\(p_i \ne i\) for all \(i\). For each pair of groups \(i, j\), a
permutation \(p\) is drawn from the uniform distribution on \(P\).
Player \(m\) of group \(i\) acts against player \(p_m\) of group \(j\).
Thus each player acts against one member of each group, and is the
target of one member from each group.

The acting player unilaterally chooses whether to ``help'' or ``harm''
the target. Helping costs 1 to the player and benefits the target by
\(b > 1\). Harming has zero cost and zero benefit. (Alternatively and
equivalently, helping has zero cost and benefit, while harming gives 1
to the player and costs the target \(b\).)

There are the following types of players:

\begin{itemize}
\tightlist
\item
  Selfish (\(s\)-) types always harm.
\item
  Generalized reciprocity (\(r\)-) types harm if and only if they were
  harmed in the previous period.
\item
  Group reciprocity (\(g\)-) types harm a target from group X, if and
  only if the last time somebody from group X acted against them, that
  person harmed them.
\end{itemize}

Let \(\pi^i_\tau\) be the proportion of individuals of type
\(\tau \in \{s, r, g\}\) in group \(i\). Let \(\pi_\tau\) be the overall
proportion of type \(\tau\) in the population.

We denote by \(h^t_{ij}\) the probability that an individual from group
\(i\) helps an individual from group \(j\) in period \(t\).

We can calculate it as follows:

\begin{equation}
h^{t+1}_{ij} = \pi^i_s0  
      + \pi^i_r \frac{1}{G}\sum_{k \in \mathcal{G}} h^t_{ki} 
      + \pi^i_g h^t_{ji}
\label{eq:help-ij}
\end{equation}

{[}XXX could we write the above in matrix form?{]}

Here, the first term reflects the fact that selfish types in group \(i\)
never help. The second term gives the probability of a r-type helping.
This is given by the overall probability that the r-type was helped by
any one actor from the \(G\) individuals (one from each group) who
targeted her in the previous period. The third term gives the
probability that a group reciprocal g-type was previously helped by an
actor from group \(j\). We set \(h^0_{ij} = 1\) for all \(i,j\),
reflecting the assumption that non-selfish types start by cooperating
(like in Tit-for-Tat).

Total payoffs are averaged over all periods and normalized by the number
of groups \(G\). When \(T \rightarrow \infty\) the payoffs will be
determined by the steady state such that
\(h^{t+1}_{ij} = h^{t}_{ij} \equiv h_{ij}\) for all
\(i,j\in \mathcal{G}\).

Denote by \(X \subset \mathcal{G}\) the set of groups \(i\) that contain
\emph{only} group-reciprocators: \(\pi^i_g = 1\).

\emph{Theorem}. Depending on whether \(\pi_s > 0\) or \(\pi_s = 0\),
there is a unique steady state. If \(\pi_s > 0\) it is as follows:

\begin{itemize}
\tightlist
\item
  For all \(i, j \in X\), \(h_{ij} = 1\).
\item
  For all \(i \notin X\) and all \(j \in \mathcal{G}\),
  \(h_{ij} = h_{ji} = 0\).
\end{itemize}

If \(\pi_s = 0\), the steady state is \(h_{ij} = 1\) for all groups
\(i, j\).

\emph{Proof}. To prove these values are steady states, plug them into
the fixed point equations:

\begin{equation}
h_{ij} = \pi^i_s0  
      + \pi^i_r \frac{1}{G}\sum_{k \in \mathcal{G}} h_{ki} 
      + \pi^i_g h_{ji}
\label{eq:help-ij-fixed}
\end{equation}

To prove they are the unique steady states: when \(\pi_s = 0\), the
second and third terms in (\ref{eq:help-ij}) always sum to 1, by
induction from the first period. (If nobody is selfish, then all players
in all groups start by helping and never have a reason to stop.)

When \(\pi_s > 0\), first note that if \(i \in X\), \(h_{ij} = h_{ji}\);
furthermore, if \(i,j \in X\), \(h_{ij} = h_{ji} = 1\) again by using
the initial condition.

Pick now \(i,j\) such that

\begin{equation}
h_{ij} = \bar{h} \equiv max_{k,l; k \notin X} h_{kl},
\label{eq:max-h}
\end{equation}

and suppose by negation that \(h_{ij} > 0\).

Fix an arbitrary group \(k\). If \(k \in X\) then \(h_{ki} = h_{ik}\) as
just noted and \(h_{ik} \le h_{ij}\) by (\ref{eq:max-h}); if
\(k \notin X\) then \(h_{ki} \le h_{ij}\) again by (\ref{eq:max-h}). In
either case, then, \(h_{ki} \le h_{ij}\), for any \(k\). Since
(\ref{eq:help-ij-fixed}) is a weighted sum of \(h_{ki}\)'s and 0, this
immediately implies:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \(\pi^i_s = 0\);
\item
  \(h_{ki} = h_{ij} = \bar{h}\) for all groups \(k\).
\end{enumerate}

Now apply the above argument to any \(i' \notin X\). This shows
\(\pi^{i'}_s = 0\) \(\forall i' \notin X\). But for \(i' \in X\),
\(\pi^{i'}_s = 0\) by definition. Thus \(\pi_s = 0\), in contradiction
to the assumption made. This shows \(h_{ik} = 0\) for all \(i \notin X\)
and all \(k \in \mathcal{G}\). Finally, if \(i \in X\) and
\(k \notin X\), we get \(h_{ik} = h_{ki}=0\). QED.

{[}XXX: there might be a simpler ``contraction mapping'' argument to
immediately prove the steady states are unique.{]}

Remark: if all groups have the same proportion of selfish types, then
group and generalized reciprocators always behave identically. This can
be shown by induction from period 1.

\hypertarget{payoffs}{%
\subsection{Payoffs}\label{payoffs}}

If \(T\) approaches infinity, the payoffs from the generation can be
approximated by the steady state payoffs, since play is arbitrarily
close to the steady state for an arbitrarily large number of periods.

The steady state payoffs for any member of group \(i \notin X\) are 0
since these groups never help and are never helped. If I am a member of
\(i \in X\), my payoffs are \(\frac{|X|}{G}(b - 1)\); each period, a
member of every group in \(X\) helps me, and I help a member of every
such group.

In general, we can compute payoffs per period. Note that within a given
group, g-types and r-types always get the same payoff. This is because
they are helped equally often, and they do the same amount of helping
(look at equation (\ref{eq:help-ij})).

\hypertarget{evolution-of-strategies}{%
\subsection{Evolution of strategies}\label{evolution-of-strategies}}

At the end of a generation, fitness is calculated according to payoffs
and there is a selection process\ldots.

\hypertarget{extensionsideas}{%
\section{Extensions/ideas}\label{extensionsideas}}

\begin{itemize}
\tightlist
\item
  Institutional evolution - i.e.~the ``types'' exist at group level
  only, avoiding any within-group heterogeneity.
\item
  Intra-group public goods
\item
  Direct reciprocity types
\item
  Doing the maths for finite \(T\)
\item
  (Re)doing the simulations for finite \(T\)
\item
  The ``blood feud'' institution in e.g.~Boehm suggests there is a
  deterrent effect - if I plan to harm another clan, my cousins may
  dissuade me. Selfish types could be (slightly) strategic, e.g.~only
  harming if there is not too much ``comeback'' in the following period.
\end{itemize}

\hypertarget{simulations}{%
\section{Simulations}\label{simulations}}

\hypertarget{conclusion}{%
\section{Conclusion}\label{conclusion}}

\end{document}
